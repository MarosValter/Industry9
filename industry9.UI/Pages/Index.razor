@page "/"
@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@using industry9.Shared.Store.Features.Dashboard.Actions
@using industry9.Shared.Store.States
@using industry9.Shared.Dto.DashboardWidget

@*@attribute [Authorize]*@

@inject IState<HomepageState> DashboardState
@inject IDispatcher Dispatcher
@inject NavigationManager NavigationManager


@if (DashboardState.Value.Dashboard != null)
{
    <LabelBar Labels="@DashboardState.Value.Dashboard.Labels"></LabelBar>

    <DashboardLayoutComponent Class="px-0" ColumnCount="4" Items="@DashboardState.Value.Dashboard.Widgets.OrderBy(x => x.Position.Y).ThenBy(x => x.Position.X).ToList()" TValue="DashboardWidgetData">
        <ItemTemplate>
            <DashboardWidgetCard @key="@context" Widget="@context.Widget"></DashboardWidgetCard>
        </ItemTemplate>
        <EmptyItemTemplate></EmptyItemTemplate>
    </DashboardLayoutComponent>

    <MatFAB Icon="@MatIconNames.Edit" Class="btn-edit-primary" OnClick="@EditDashboard"></MatFAB>
}

@code {

    private void EditDashboard()
    {
        Dispatcher.Dispatch(new InitDashboardAction(DashboardState.Value.Dashboard.Id));
        Dispatcher.Dispatch(new ToggleEditModeAction(true, false));
        NavigationManager.NavigateTo("/dashboards");
    }
}
